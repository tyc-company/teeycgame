<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ¨ç®±å­</title>
<style>
body { text-align: center; font-family: Arial, sans-serif; background: #f0f0f0; }
h2 { color: #ff6600; }
#game { display: inline-block; margin-top: 20px; }
.cell { width: 40px; height: 40px; display: inline-block; vertical-align: top; line-height: 40px; font-size: 24px; border: 1px solid #ccc; }
.wall { background: #888; }
.player { background: #4caf50; color: white; }
.box { background: #ff9800; color: white; }
.target { background: #ffc107; }
.box.target { background: #ff5722; }
</style>
</head>
<body>
<h2>æ¨ç®±å­ ğŸ§±â¡ï¸ğŸ“¦</h2>
<div id="game"></div>
<p>ç”¨ç®­å¤´é”®ç§»åŠ¨</p>

<script>
const levels = [
`#####
#@ $.#
#   #
#####`,
`#######
#@ $. #
#  $  #
#  .  #
#######`
];

let currentLevel = 0;
let map = [];
let grid = [];
let player = {x:0, y:0};

function loadLevel(levelIndex){
    map = levels[levelIndex].split('\n');
    init();
}

function init() {
    const container = document.getElementById('game');
    container.innerHTML = "";
    grid = [];
    for(let y=0;y<map.length;y++){
        const row = [];
        const line = map[y];
        const divRow = document.createElement('div');
        for(let x=0;x<line.length;x++){
            const cell = line[x];
            const div = document.createElement('div');
            div.className = 'cell';
            if(cell === '#') div.classList.add('wall');
            else if(cell === '@') { div.classList.add('player'); player = {x,y}; }
            else if(cell === '$') div.classList.add('box');
            else if(cell === '.') div.classList.add('target');
            else if(cell === '*') div.classList.add('box','target');
            row.push({el: div, type: cell});
            divRow.appendChild(div);
        }
        container.appendChild(divRow);
        grid.push(row);
    }
}

function move(dx,dy){
    const x = player.x;
    const y = player.y;
    const targetX = x+dx;
    const targetY = y+dy;
    const targetCell = grid[targetY][targetX];

    if(targetCell.type === '#' ) return; //å¢™
    if(targetCell.type === '$' || targetCell.type === '*'){ //ç®±å­
        const nextX = targetX+dx;
        const nextY = targetY+dy;
        const nextCell = grid[nextY][nextX];
        if(nextCell.type === ' ' || nextCell.type === '.') { 
            if(nextCell.type === '.') nextCell.type = '*';
            else nextCell.type = '$';
            targetCell.type = (targetCell.type==='*') ? '.' : ' ';
        } else return; //ä¸èƒ½æ¨
    }
    //ç§»åŠ¨ç©å®¶
    const currentCell = grid[y][x];
    currentCell.type = (currentCell.type==='@') ? ' ' : '.';
    targetCell.type = (targetCell.type==='.') ? '@' : '@';
    player = {x: targetX, y: targetY};
    render();
    checkWin();
}

function render(){
    for(let y=0;y<grid.length;y++){
        for(let x=0;x<grid[y].length;x++){
            const c = grid[y][x];
            c.el.className = 'cell';
            if(c.type === '#') c.el.classList.add('wall');
            else if(c.type === '@') c.el.classList.add('player');
            else if(c.type === '$') c.el.classList.add('box');
            else if(c.type === '.') c.el.classList.add('target');
            else if(c.type === '*') c.el.classList.add('box','target');
        }
    }
}

function checkWin(){
    for(let y=0;y<grid.length;y++){
        for(let x=0;x<grid[y].length;x++){
            if(grid[y][x].type === '$') return;
        }
    }
    //å…¨éƒ¨ç®±å­åˆ°ç›®æ ‡äº† â†’ è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å…³
    alert("å…³å¡å®Œæˆ ğŸ‰");
    currentLevel++;
    if(currentLevel >= levels.length){
        alert("ä½ å·²ç»å®Œæˆæ‰€æœ‰å…³å¡ï¼æ¸¸æˆé‡æ–°å¼€å§‹");
        currentLevel = 0;
    }
    loadLevel(currentLevel);
}

document.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp') move(0,-1);
    else if(e.key==='ArrowDown') move(0,1);
    else if(e.key==='ArrowLeft') move(-1,0);
    else if(e.key==='ArrowRight') move(1,0);
});

//åˆå§‹åŠ è½½ç¬¬ä¸€å…³
loadLevel(currentLevel);
</script>
</body>
</html>
