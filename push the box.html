<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>éšæœºå¯è§£ Emoji æ¨ç®±å­</title>
<style>
body { text-align: center; font-family: Arial, sans-serif; background: #f0f0f0; }
h2 { color: #ff6600; }
#game { display: inline-block; margin-top: 20px; }
.cell { width: 40px; height: 40px; display: inline-block; vertical-align: top; line-height: 40px; font-size: 24px; border: 1px solid #ccc; }
button { margin: 10px; padding: 5px 15px; font-size: 16px; border-radius: 5px; background-color: #ffcc66; border: none; cursor: pointer; }
button:hover { background-color: #ff9900; color: white; }
</style>
</head>
<body>
<h2>éšæœºå¯è§£ Emoji æ¨ç®±å­ ğŸ§±ğŸ¤—ğŸ“¦âŒâš“</h2>
<button onclick="resetLevel()">é‡ç½®å…³å¡</button>
<div id="game"></div>
<p>ç”¨ç®­å¤´é”®ç§»åŠ¨</p>

<script>
let grid=[], player={x:0,y:0}, rows=0, cols=0, boxCount=0, level=1;
let initialState=[]; // ä¿å­˜åˆå§‹çŠ¶æ€ç”¨äºé‡ç½®

function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function cloneGrid(g){ return g.map(r=>r.slice()); }

// åˆ¤æ–­æ˜¯å¦è§’è½
function isCorner(x,y){ 
    let walls=0;
    if(grid[y-1][x]==='ğŸ§±' || grid[y-1][x]==='âš“') walls++;
    if(grid[y+1][x]==='ğŸ§±' || grid[y+1][x]==='âš“') walls++;
    if(grid[y][x-1]==='ğŸ§±' || grid[y][x-1]==='âš“') walls++;
    if(grid[y][x+1]==='ğŸ§±' || grid[y][x+1]==='âš“') walls++;
    return walls>=2;
}

// ç®€å•å¯è§£æ£€æŸ¥ï¼šæ¯ä¸ªç®±å­å‘¨å›´è‡³å°‘æœ‰ä¸€ä¸ªç©ºæ ¼å¯æ¨åŠ¨
function isSolvable(){
    for(let y=1;y<rows-1;y++){
        for(let x=1;x<cols-1;x++){
            if(grid[y][x]==='ğŸ“¦'){
                let canPush=false;
                if(grid[y-1][x]===' ' || grid[y+1][x]===' ' || grid[y][x-1]===' ' || grid[y][x+1]===' ') canPush=true;
                if(!canPush) return false;
            }
        }
    }
    return true;
}

// éšæœºç”Ÿæˆåœ°å›¾
function generateLevel(){
    while(true){
        rows=rand(8,12); cols=rand(8,12);
        grid=[];
        for(let y=0;y<rows;y++){
            const row=[];
            for(let x=0;x<cols;x++){
                if(y===0||y===rows-1||x===0||x===cols-1) row.push('ğŸ§±');
                else row.push(' ');
            }
            grid.push(row);
        }

        // æ·»åŠ éšæœºéšœç¢
        let obstacles=rand(3,6);
        while(obstacles>0){
            let x=rand(1,cols-2), y=rand(1,rows-2);
            if(grid[y][x]===' '){ grid[y][x]='âš“'; obstacles--; }
        }

        // æ”¾ç©å®¶
        while(true){
            let px=rand(1,cols-2), py=rand(1,rows-2);
            if(grid[py][px]===' '){ grid[py][px]='ğŸ¤—'; player={x:px,y:py}; break; }
        }

        // ç®±å­æ•°é‡
        boxCount=Math.min(rand(1,4), Math.floor(rows*cols/10));
        let placed=0;
        while(placed<boxCount){
            let bx=rand(1,cols-2), by=rand(1,rows-2);
            if(grid[by][bx]===' ' && !isCorner(bx,by)){
                grid[by][bx]='ğŸ“¦'; placed++;
            }
        }

        // ç›®æ ‡
        placed=0;
        while(placed<boxCount){
            let tx=rand(1,cols-2), ty=rand(1,rows-2);
            if(grid[ty][tx]===' '){ grid[ty][tx]='âŒ'; placed++; }
        }

        if(isSolvable()) break;
    }
    initialState=cloneGrid(grid); // ä¿å­˜åˆå§‹çŠ¶æ€
    render();
}

// æ¸²æŸ“åœ°å›¾
function render(){
    const container=document.getElementById('game');
    container.innerHTML='';
    for(let y=0;y<rows;y++){
        const divRow=document.createElement('div');
        for(let x=0;x<cols;x++){
            const div=document.createElement('div');
            div.className='cell';
            div.textContent=grid[y][x];
            divRow.appendChild(div);
        }
        container.appendChild(divRow);
    }
}

// ç©å®¶ç§»åŠ¨
function move(dx,dy){
    const x=player.x, y=player.y;
    const nx=x+dx, ny=y+dy;
    if(nx<0||nx>=cols||ny<0||ny>=rows) return;
    const target=grid[ny][nx];
    if(target==='ğŸ§±'||target==='âš“') return;
    if(target==='ğŸ“¦'){
        const nnx=nx+dx, nny=ny+dy;
        if(nnx<0||nnx>=cols||nny<0||nny>=rows) return;
        const next=grid[nny][nnx];
        if(next===' ' || next==='âŒ'){
            grid[nny][nnx]='ğŸ“¦';
            grid[ny][nx]='ğŸ¤—';
            grid[y][x]=' ';
            player={x:nx,y:ny};
            render();
            checkWin();
        }
        return;
    }
    if(target===' ' || target==='âŒ'){
        grid[ny][nx]='ğŸ¤—';
        grid[y][x]=' ';
        player={x:nx,y:ny};
        render();
        checkWin();
    }
}

// æ£€æµ‹èƒœåˆ©
function checkWin(){
    for(let y=0;y<rows;y++){
        for(let x=0;x<cols;x++){
            if(grid[y][x]==='ğŸ“¦'){
                let onTarget=false;
                for(let yy=0;yy<rows;yy++){
                    for(let xx=0;xx<cols;xx++){
                        if(grid[yy][xx]==='âŒ' && x===xx && y===yy) onTarget=true;
                    }
                }
                if(!onTarget) return false;
            }
        }
    }
    alert(`ç¬¬ ${level} å…³å®Œæˆ ğŸ‰`);
    level++;
    generateLevel();
}

// é‡ç½®å…³å¡
function resetLevel(){
    grid=cloneGrid(initialState);
    render();
}

document.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp') move(0,-1);
    else if(e.key==='ArrowDown') move(0,1);
    else if(e.key==='ArrowLeft') move(-1,0);
    else if(e.key==='ArrowRight') move(1,0);
});

// åˆå§‹ç”Ÿæˆ
generateLevel();
</script>
</body>
</html>
