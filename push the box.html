<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ¨ç®±å­ï¼ˆæ¯ç®±å¯¹åº”ä¸€ä¸ªç›®æ ‡ï¼‰</title>
<style>
body { text-align: center; font-family: Arial, sans-serif; background: #f0f0f0; }
h2 { color: #ff6600; }
#game { display: inline-block; margin-top: 20px; }
.cell { width: 40px; height: 40px; display: inline-block; vertical-align: top; line-height: 40px; font-size: 24px; border: 1px solid #ccc; }
button { margin: 10px; padding: 5px 15px; font-size: 16px; border-radius: 5px; background-color: #ffcc66; border: none; cursor: pointer; }
button:hover { background-color: #ff9900; color: white; }
</style>
</head>
<body>
<h2>æ¨ç®±å­ ğŸ§±ğŸ¤—ğŸ“¦âŒâš“</h2>
<button onclick="resetLevel()">é‡ç½®å…³å¡</button>
<div id="game"></div>
<p>ç”¨ç®­å¤´é”®ç§»åŠ¨</p>

<script>
let grid=[], player={x:0,y:0}, rows=0, cols=0, boxCount=0, level=1;
let initialState=[];

function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function cloneGrid(g){ return g.map(r=>r.slice()); }

// æ£€æŸ¥æ˜¯å¦è§’è½
function isCorner(x,y){
    let walls=0;
    if(grid[y-1][x]==='ğŸ§±'||grid[y-1][x]==='âš“') walls++;
    if(grid[y+1][x]==='ğŸ§±'||grid[y+1][x]==='âš“') walls++;
    if(grid[y][x-1]==='ğŸ§±'||grid[y][x-1]==='âš“') walls++;
    if(grid[y][x+1]==='ğŸ§±'||grid[y][x+1]==='âš“') walls++;
    return walls>=2;
}

// ç”Ÿæˆå¯è§£å…³å¡ï¼Œæ¯ä¸ªç®±å­å¯¹åº”ä¸€ä¸ªç›®æ ‡
function generateLevel(){
    rows=rand(8,12);
    cols=rand(8,12);
    grid=[];

    // ç©ºåœ°å›¾ + å¢™
    for(let y=0;y<rows;y++){
        const row=[];
        for(let x=0;x<cols;x++){
            if(y===0||y===rows-1||x===0||x===cols-1) row.push('ğŸ§±');
            else row.push(' ');
        }
        grid.push(row);
    }

    // ç®±å­æ•°é‡
    boxCount=Math.min(rand(1,4),Math.floor(rows*cols/10));
    let boxes=[], targets=[];

    for(let i=0;i<boxCount;i++){
        // éšæœºç›®æ ‡
        while(true){
            let tx=rand(1,cols-2), ty=rand(1,rows-2);
            if(grid[ty][tx]===' '){ grid[ty][tx]='âŒ'; targets.push({x:tx,y:ty}); break; }
        }
        // ä»ç›®æ ‡ç”Ÿæˆç®±å­è·¯å¾„
        let path=[], bx=targets[i].x, by=targets[i].y;
        let dirOptions=[[0,-1],[0,1],[-1,0],[1,0]];
        let steps=rand(2,4);
        for(let s=0;s<steps;s++){
            let d=dirOptions[Math.floor(Math.random()*dirOptions.length)];
            let nx=bx+d[0], ny=by+d[1];
            if(grid[ny][nx]===' '){ bx=nx; by=ny; path.push({x:bx,y:by}); }
        }
        if(path.length>0){
            let last=path[path.length-1];
            grid[last.y][last.x]='ğŸ“¦';
            boxes.push(last);
        }
    }

    // ç©å®¶æ”¾åœ¨ç©ºæ ¼
    while(true){
        let px=rand(1,cols-2), py=rand(1,rows-2);
        if(grid[py][px]===' '){ grid[py][px]='ğŸ¤—'; player={x:px,y:py}; break; }
    }

    // éšæœºéšœç¢
    let obstacles=rand(3,6);
    while(obstacles>0){
        let ox=rand(1,cols-2), oy=rand(1,rows-2);
        if(grid[oy][ox]===' '){ grid[oy][ox]='âš“'; obstacles--; }
    }

    initialState=cloneGrid(grid);
    render();
}

// æ¸²æŸ“åœ°å›¾
function render(){
    const container=document.getElementById('game');
    container.innerHTML='';
    for(let y=0;y<rows;y++){
        const divRow=document.createElement('div');
        for(let x=0;x<cols;x++){
            const div=document.createElement('div');
            div.className='cell';
            div.textContent=grid[y][x];
            divRow.appendChild(div);
        }
        container.appendChild(divRow);
    }
}

// ç§»åŠ¨é€»è¾‘
function move(dx,dy){
    const x=player.x, y=player.y;
    const nx=x+dx, ny=y+dy;
    if(nx<0||nx>=cols||ny<0||ny>=rows) return;
    const target=grid[ny][nx];
    if(target==='ğŸ§±'||target==='âš“') return;
    if(target==='ğŸ“¦'){
        const nnx=nx+dx, nny=ny+dy;
        if(nnx<0||nnx>=cols||nny<0||nny>=rows) return;
        const next=grid[nny][nnx];
        if(next===' ' || next==='âŒ'){
            grid[nny][nnx]='ğŸ“¦';
            grid[ny][nx]='ğŸ¤—';
            grid[y][x]=' ';
            player={x:nx,y:ny};
            render();
            checkWin();
        }
        return;
    }
    if(target===' ' || target==='âŒ'){
        grid[ny][nx]='ğŸ¤—';
        grid[y][x]=' ';
        player={x:nx,y:ny};
        render();
        checkWin();
    }
}

// æ£€æŸ¥èƒœåˆ©
function checkWin(){
    for(let y=0;y<rows;y++){
        for(let x=0;x<cols;x++){
            if(grid[y][x]==='ğŸ“¦'){
                let onTarget=false;
                for(let t of grid.flat().map((c,i)=>({c,i}))){ 
                    let yy=Math.floor(t.i/cols), xx=t.i%cols;
                    if(t.c==='âŒ' && xx===x && yy===y) onTarget=true;
                }
                if(!onTarget) return false;
            }
        }
    }
    alert(`ç¬¬ ${level} å…³å®Œæˆ ğŸ‰`);
    level++;
    generateLevel();
}

// é‡ç½®å…³å¡
function resetLevel(){
    grid=cloneGrid(initialState);
    render();
}

document.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp') move(0,-1);
    else if(e.key==='ArrowDown') move(0,1);
    else if(e.key==='ArrowLeft') move(-1,0);
    else if(e.key==='ArrowRight') move(1,0);
});

generateLevel();
</script>
</body>
</html>

