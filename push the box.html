<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ¨ç®±å­</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; }
  table { margin: 20px auto; border-collapse: collapse; }
  td { width: 40px; height: 40px; text-align: center; vertical-align: middle; font-size: 32px; border: 1px solid #ccc; }
  button { margin: 5px; padding: 5px 10px; font-size: 16px; }
</style>
</head>
<body>

<h2>æ¨ç®±å­ ğŸ§±ğŸ“¦ğŸ¤—âŒ</h2>
<button id="resetBtn">é‡ç½®å…³å¡</button>
<div id="levelInfo"></div>
<div id="gameBoard"></div>

<script>
const WALL = 'ğŸ§±';
const PLAYER = 'ğŸ¤—';
const BOX = 'ğŸ“¦';
const TARGET = 'âŒ';
const BOX_ON_TARGET = 'âœ…';

// å®šä¹‰å…³å¡ç¤ºä¾‹ï¼ˆ1=å¢™, 0=ç©º, B=ç®±å­, T=ç›®æ ‡, P=ç©å®¶ï¼‰
const levels = [
  [
    ['ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±'],
    ['ğŸ§±',' ','ğŸ“¦','âŒ','ğŸ§±'],
    ['ğŸ§±',' ','ğŸ¤—',' ','ğŸ§±'],
    ['ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±']
  ],
  [
    ['ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±'],
    ['ğŸ§±',' ',' ','ğŸ“¦','âŒ','ğŸ§±'],
    ['ğŸ§±',' ','ğŸ¤—',' ',' ','ğŸ§±'],
    ['ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±','ğŸ§±']
  ]
];

let currentLevel = 0;
let map = [];
let player = {x:0, y:0};

// æ·±æ‹·è´å…³å¡
function loadLevel(levelIndex){
  map = JSON.parse(JSON.stringify(levels[levelIndex]));
  // æ‰¾åˆ°ç©å®¶
  for(let y=0; y<map.length; y++){
    for(let x=0; x<map[y].length; x++){
      if(map[y][x]===PLAYER){
        player = {x:x, y:y};
      }
    }
  }
  drawMap();
  document.getElementById('levelInfo').innerText = `ç¬¬ ${currentLevel+1} å…³`;
}

// ç»˜åˆ¶åœ°å›¾
function drawMap(){
  const board = document.getElementById('gameBoard');
  let html = '<table>';
  for(let y=0; y<map.length; y++){
    html += '<tr>';
    for(let x=0; x<map[y].length; x++){
      html += `<td>${map[y][x]}</td>`;
    }
    html += '</tr>';
  }
  html += '</table>';
  board.innerHTML = html;
}

// ç§»åŠ¨
function move(dx, dy){
  const nx = player.x + dx;
  const ny = player.y + dy;
  const nnx = nx + dx;
  const nny = ny + dy;

  // ç¢°å¢™
  if(map[ny][nx]===WALL) return;

  // ç¢°ç®±å­
  if(map[ny][nx]===BOX || map[ny][nx]===BOX_ON_TARGET){
    // å‰æ–¹ç©ºåœ°æˆ–ç›®æ ‡å¯æ¨
    if(map[nny][nnx]=== ' '){
      map[nny][nnx]=BOX;
    } else if(map[nny][nnx]===TARGET){
      map[nny][nnx]=BOX_ON_TARGET;
    } else {
      return; // æ¨ä¸äº†
    }
    // æ¨åŠ¨ç®±å­ååŸä½æ¢å¤ç›®æ ‡æˆ–ç©ºæ ¼
    map[ny][nx] = (map[ny][nx]===BOX_ON_TARGET)?TARGET:' ';
  }

  // ç©å®¶ç§»åŠ¨
  map[player.y][player.x] = ' ';
  player.x = nx; player.y = ny;
  map[player.y][player.x] = PLAYER;

  drawMap();
  checkWin();
}

// æ£€æŸ¥å…³å¡æ˜¯å¦å®Œæˆ
function checkWin(){
  for(let y=0; y<map.length; y++){
    for(let x=0; x<map[y].length; x++){
      if(map[y][x]===BOX) return;
    }
  }
  // å…¨éƒ¨ç®±å­åˆ°ç›®æ ‡
  alert('å®Œæˆå…³å¡ ğŸ‰');
  currentLevel++;
  if(currentLevel >= levels.length){
    alert('æ­å–œï¼å·²å®Œæˆæ‰€æœ‰å…³å¡ï¼');
    currentLevel = 0;
  }
  loadLevel(currentLevel);
}

// é”®ç›˜æ§åˆ¶
document.addEventListener('keydown', e=>{
  if(!player) return;
  if(e.key==='ArrowUp') move(0,-1);
  else if(e.key==='ArrowDown') move(0,1);
  else if(e.key==='ArrowLeft') move(-1,0);
  else if(e.key==='ArrowRight') move(1,0);
});

// é‡ç½®å…³å¡
document.getElementById('resetBtn').addEventListener('click', ()=>{
  loadLevel(currentLevel);
});

// åˆå§‹åŒ–
loadLevel(currentLevel);
</script>

</body>
</html>

