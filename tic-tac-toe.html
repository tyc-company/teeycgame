<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>井字棋❌⭕</title>
<style>
body{text-align:center;font-family:Arial;}
canvas{border:2px solid #333;margin-top:10px;}
button{margin:5px;padding:6px 10px;font-size:16px;}
#mode{margin-top:10px;}
</style>
</head>
<body>
<h2>欢迎游玩井字棋</h2>
<div id="mode">
  <button onclick="startGame('human')">人 vs 人</button>
  <button onclick="startGame('ai')">人 vs AI</button>
  <button onclick="resetGame()">重置</button>
</div>
<canvas id="board" width="300" height="300"></canvas>

<script>
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d');
const size = 100;
let board = []; // 3x3棋盘
let currentPlayer = 'X';
let gameOver = false;
let mode = 'human'; // human或ai

// 初始化棋盘
function initBoard(){
    board = [];
    for(let i=0;i<3;i++){
        board[i] = [];
        for(let j=0;j<3;j++) board[i][j] = '';
    }
    currentPlayer = 'X';
    gameOver = false;
    drawBoard();
}

// 绘制棋盘
function drawBoard(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle='#000';
    ctx.lineWidth=2;
    for(let i=1;i<3;i++){
        ctx.beginPath();
        ctx.moveTo(i*size,0); ctx.lineTo(i*size,3*size); ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0,i*size); ctx.lineTo(3*size,i*size); ctx.stroke();
    }
    // 绘制棋子
    ctx.font="60px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    for(let i=0;i<3;i++){
        for(let j=0;j<3;j++){
            if(board[i][j]!=='') ctx.fillText(board[i][j], j*size+size/2, i*size+size/2);
        }
    }
}

// 点击下棋
canvas.addEventListener('click', e=>{
    if(gameOver) return;
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((e.clientX-rect.left)/size);
    const y = Math.floor((e.clientY-rect.top)/size);
    if(board[y][x]===''){
        board[y][x] = currentPlayer;
        if(checkWin(board,currentPlayer)){
            gameOver=true; alert(currentPlayer+' 胜利！'); return;
        } else if(isDraw()){
            gameOver=true; alert('平局！'); return;
        }
        currentPlayer = currentPlayer==='X'?'O':'X';
        if(mode==='ai' && currentPlayer==='O') aiMove();
    }
    drawBoard();
});

// AI落子（极小化极大算法）
function aiMove(){
    let bestScore=-Infinity;
    let move=null;
    for(let i=0;i<3;i++){
        for(let j=0;j<3;j++){
            if(board[i][j]===''){
                board[i][j]='O';
                let score = minimax(board,false);
                board[i][j]='';
                if(score>bestScore){ bestScore=score; move={i,j}; }
            }
        }
    }
    if(move){
        board[move.i][move.j]='O';
        if(checkWin(board,'O')){
            gameOver=true; alert('AI 胜利！'); return;
        } else if(isDraw()){
            gameOver=true; alert('平局！'); return;
        }
        currentPlayer='X';
        drawBoard();
    }
}

// 极小化极大算法
function minimax(b, isMaximizing){
    if(checkWin(b,'O')) return 1;
    if(checkWin(b,'X')) return -1;
    if(isDraw()) return 0;

    if(isMaximizing){
        let best=-Infinity;
        for(let i=0;i<3;i++){
            for(let j=0;j<3;j++){
                if(b[i][j]===''){
                    b[i][j]='O';
                    best=Math.max(best,minimax(b,false));
                    b[i][j]='';
                }
            }
        }
        return best;
    }else{
        let best=Infinity;
        for(let i=0;i<3;i++){
            for(let j=0;j<3;j++){
                if(b[i][j]===''){
                    b[i][j]='X';
                    best=Math.min(best,minimax(b,true));
                    b[i][j]='';
                }
            }
        }
        return best;
    }
}

// 检查胜利
function checkWin(b,player){
    for(let i=0;i<3;i++){
        if(b[i][0]===player && b[i][1]===player && b[i][2]===player) return true;
        if(b[0][i]===player && b[1][i]===player && b[2][i]===player) return true;
    }
    if(b[0][0]===player && b[1][1]===player && b[2][2]===player) return true;
    if(b[0][2]===player && b[1][1]===player && b[2][0]===player) return true;
    return false;
}

// 平局判断
function isDraw(){
    return board.flat().every(c=>c!=='');
}

// 开始游戏模式
function startGame(m){
    mode=m;
    initBoard();
}

// 重置游戏
function resetGame(){
    initBoard();
}

initBoard();
</script>
</body>
</html>
