<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è‡ªå®šä¹‰è´ªåƒè›‡</title>
<style>
body { text-align: center; font-family: Arial, sans-serif; background: #f0f0f0; }
canvas { background: #eee; display: block; margin: 20px auto; border:2px solid #333; }
button { margin:5px; padding:5px 15px; font-size:16px; }
#menu { margin-top: 20px; }
</style>
</head>
<body>
<h2>è‡ªå®šä¹‰è´ªåƒè›‡ ğŸ</h2>
<div id="menu">
  <label>é€‰æ‹©è›‡é¢œè‰²: 
    <select id="colorSelect">
      <option value="red">çº¢è‰²</option>
      <option value="green">ç»¿è‰²</option>
      <option value="black">é»‘è‰²</option>
      <option value="blue">è“è‰²</option>
      <option value="yellow">é»„è‰²</option>
      <option value="rainbow">å½©è™¹</option>
    </select>
  </label>
  <label>èº«ä½“å½¢çŠ¶:
    <select id="shapeSelect">
      <option value="square">æ­£æ–¹å½¢</option>
      <option value="circle">åœ†å½¢</option>
    </select>
  </label>
  <button onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
</div>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const rows=20, cols=20;
const cellSize=20;

let snake=[], dir={x:1,y:0}, food={x:0,y:0}, gameInterval;
let snakeColor='green', snakeShape='square';
let rainbowColors=['red','orange','yellow','green','blue','purple'];
let rainbowIndex=0;

function startGame(){
  snakeColor=document.getElementById('colorSelect').value;
  snakeShape=document.getElementById('shapeSelect').value;
  resetGame();
}

function resetGame(){
  clearInterval(gameInterval);
  snake=[{x:10,y:10}];
  dir={x:1,y:0};
  placeFood();
  gameInterval=setInterval(gameLoop,150);
}

function placeFood(){
  while(true){
    food={x:Math.floor(Math.random()*cols), y:Math.floor(Math.random()*rows)};
    if(!snake.some(s=>s.x===food.x && s.y===food.y)) break;
  }
}

document.addEventListener('keydown',e=>{
  if(e.key==='ArrowUp' && dir.y!==1) dir={x:0,y:-1};
  else if(e.key==='ArrowDown' && dir.y!==-1) dir={x:0,y:1};
  else if(e.key==='ArrowLeft' && dir.x!==1) dir={x:-1,y:0};
  else if(e.key==='ArrowRight' && dir.x!==-1) dir={x:1,y:0};
});

function gameLoop(){
  let head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};

  // è¾¹ç•Œç¢°æ’
  if(head.x<0||head.x>=cols||head.y<0||head.y>=rows){
    alert('æ¸¸æˆç»“æŸï¼');
    resetGame();
    return;
  }

  // èº«ä½“ç¢°æ’
  if(snake.some(s=>s.x===head.x && s.y===head.y)){
    alert('æ¸¸æˆç»“æŸï¼');
    resetGame();
    return;
  }

  snake.unshift(head);

  // åƒé£Ÿç‰©
  if(head.x===food.x && head.y===food.y){
    placeFood();
  } else {
    snake.pop();
  }

  draw();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // é£Ÿç‰©
  ctx.fillStyle='red';
  ctx.fillRect(food.x*cellSize, food.y*cellSize, cellSize, cellSize);

  // è›‡èº«
  for(let i=0;i<snake.length;i++){
    let s=snake[i];
    let color=snakeColor;
    if(snakeColor==='rainbow'){
      color=rainbowColors[(rainbowIndex+i)%rainbowColors.length];
    }
    ctx.fillStyle=color;

    if(i===0){
      // è›‡å¤´
      ctx.beginPath();
      ctx.moveTo(s.x*cellSize+cellSize/2, s.y*cellSize+cellSize/4);
      ctx.lineTo(s.x*cellSize+cellSize/4, s.y*cellSize+3*cellSize/4);
      ctx.lineTo(s.x*cellSize+3*cellSize/4, s.y*cellSize+3*cellSize/4);
      ctx.closePath();
      ctx.fill();
    } else {
      if(snakeShape==='circle'){
        ctx.beginPath();
        ctx.arc(s.x*cellSize+cellSize/2, s.y*cellSize+cellSize/2, cellSize/2-1,0,Math.PI*2);
        ctx.fill();
      } else {
        ctx.fillRect(s.x*cellSize+1, s.y*cellSize+1, cellSize-2, cellSize-2);
      }
    }
  }
  if(snakeColor==='rainbow') rainbowIndex=(rainbowIndex+1)%rainbowColors.length;
}
</script>
</body>
</html>
