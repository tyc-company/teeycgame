<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è´ªåƒè›‡ ğŸ</title>
<style>
  body { text-align: center; font-family: Arial, sans-serif; background: #f0f0f0; }
  canvas { background: #fff; display: block; margin: 20px auto; border: 2px solid #333; }
  button, select { margin: 5px; padding: 5px 10px; font-size: 16px; border-radius: 5px; }
</style>
</head>
<body>

<h2>è´ªåƒè›‡ ğŸ</h2>
<label>é€‰æ‹©è›‡é¢œè‰²ï¼š
  <select id="snakeColorSelect">
    <option value="green">ç»¿è‰²</option>
    <option value="red">çº¢è‰²</option>
    <option value="blue">è“è‰²</option>
    <option value="black">é»‘è‰²</option>
    <option value="yellow">é»„è‰²</option>
    <option value="rainbow">å½©è™¹</option>
  </select>
</label>
<label>èº«ä½“å½¢çŠ¶ï¼š
  <select id="snakeShapeSelect">
    <option value="square">æ–¹å½¢</option>
    <option value="circle">åœ†å½¢</option>
  </select>
</label>
<br>
<button id="startButton">å¼€å§‹æ¸¸æˆ</button>
<canvas id="snakeCanvas" width="400" height="400"></canvas>

<script>
const canvas = document.getElementById('snakeCanvas');
const ctx = canvas.getContext('2d');

const size = 20;
const cols = canvas.width / size;
const rows = canvas.height / size;

let snake = [];
let dir = {x:1, y:0};
let food = {};
let obstacles = [];
let gameInterval = null;
let gameRunning = false;
let snakeColor = 'green';
let snakeShape = 'square';
let rainbowColors = ['red','orange','yellow','green','blue','purple'];
let rainbowIndex = 0;

// å¼€å§‹/é‡ç½®æ¸¸æˆ
function startSnakeGame() {
    clearInterval(gameInterval);
    snakeColor = document.getElementById('snakeColorSelect').value;
    snakeShape = document.getElementById('snakeShapeSelect').value;
    snake = [{x:5,y:5}];
    dir = {x:1,y:0};
    placeFood();
    generateObstacles(10);
    gameRunning = true;
    gameInterval = setInterval(updateSnake, 150);
}

// æ”¾ç½®é£Ÿç‰© ğŸ
function placeFood() {
    while(true) {
        let fx = Math.floor(Math.random()*cols);
        let fy = Math.floor(Math.random()*rows);
        if(!snake.some(s=>s.x===fx && s.y===fy) && !obstacles.some(o=>o.x===fx && o.y===fy)) {
            food = {x:fx, y:fy};
            break;
        }
    }
}

// éšæœºéšœç¢ç‰© ğŸª¨
function generateObstacles(count) {
    obstacles = [];
    for(let i=0;i<count;i++) {
        while(true){
            let ox=Math.floor(Math.random()*cols);
            let oy=Math.floor(Math.random()*rows);
            if(!snake.some(s=>s.x===ox && s.y===oy) &&
               !obstacles.some(o=>o.x===ox && o.y===oy) &&
               !(food.x===ox && food.y===oy)) {
                obstacles.push({x:ox,y:oy});
                break;
            }
        }
    }
}

// æ¸¸æˆæ›´æ–°
function updateSnake() {
    if(!gameRunning) return;

    let head = {x:snake[0].x+dir.x, y:snake[0].y+dir.y};

    if(head.x<0 || head.x>=cols || head.y<0 || head.y>=rows ||
       snake.some(s=>s.x===head.x && s.y===head.y) ||
       obstacles.some(o=>o.x===head.x && o.y===head.y)) {
        alert("æ¸¸æˆç»“æŸï¼ğŸ’€");
        clearInterval(gameInterval);
        gameRunning=false;
        return;
    }

    snake.unshift(head);

    if(head.x===food.x && head.y===food.y){
        placeFood();
    } else {
        snake.pop();
    }

    drawSnake();
}

// ç»˜åˆ¶
function drawSnake() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ç»˜åˆ¶é£Ÿç‰© ğŸ
    ctx.fillStyle="red";
    ctx.font = size + "px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText("ğŸ", food.x*size + size/2, food.y*size + size/2);

    // ç»˜åˆ¶éšœç¢ç‰© ğŸª¨
    ctx.font = size + "px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    for(let o of obstacles){
        ctx.fillText("ğŸª¨", o.x*size + size/2, o.y*size + size/2);
    }

    // ç»˜åˆ¶è›‡èº«ä½“
    for(let i=1;i<snake.length;i++){
        let s = snake[i];
        if(snakeColor==='rainbow'){
            ctx.fillStyle = rainbowColors[(rainbowIndex+i)%rainbowColors.length];
        } else {
            ctx.fillStyle = snakeColor;
        }
        if(snakeShape==='circle'){
            ctx.beginPath();
            ctx.arc(s.x*size + size/2, s.y*size + size/2, size/2, 0, Math.PI*2);
            ctx.fill();
        } else {
            ctx.fillRect(s.x*size, s.y*size, size, size);
        }
    }

    // ç»˜åˆ¶è›‡å¤´å°–ç«¯æœå‘ç§»åŠ¨æ–¹å‘
    let head = snake[0];
    ctx.fillStyle=(snakeColor==='rainbow')?rainbowColors[rainbowIndex%rainbowColors.length]:snakeColor;
    ctx.beginPath();
    let px = head.x*size, py = head.y*size;
    if(dir.x===1){ // å³
        ctx.moveTo(px, py);
        ctx.lineTo(px, py+size);
        ctx.lineTo(px+size, py+size/2);
    } else if(dir.x===-1){ // å·¦
        ctx.moveTo(px+size, py);
        ctx.lineTo(px+size, py+size);
        ctx.lineTo(px, py+size/2);
    } else if(dir.y===1){ // ä¸‹
        ctx.moveTo(px, py);
        ctx.lineTo(px+size, py);
        ctx.lineTo(px+size/2, py+size);
    } else if(dir.y===-1){ // ä¸Š
        ctx.moveTo(px, py+size);
        ctx.lineTo(px+size, py+size);
        ctx.lineTo(px+size/2, py);
    }
    ctx.closePath();
    ctx.fill();

    if(snakeColor==='rainbow') rainbowIndex = (rainbowIndex + 1) % rainbowColors.length;
}

// é”®ç›˜æ§åˆ¶
document.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp' && dir.y!==1) dir={x:0,y:-1};
    else if(e.key==='ArrowDown' && dir.y!==-1) dir={x:0,y:1};
    else if(e.key==='ArrowLeft' && dir.x!==1) dir={x:-1,y:0};
    else if(e.key==='ArrowRight' && dir.x!==-1) dir={x:1,y:0};
});

// ç‚¹å‡»å¼€å§‹æŒ‰é’®
document.getElementById('startButton').addEventListener('click', ()=>{
    if(!gameRunning) startSnakeGame();
});
</script>

</body>
</html>
